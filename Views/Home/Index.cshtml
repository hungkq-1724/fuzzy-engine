@model WebApplication2.Models.HomeViewModel
@using System.Web

@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Bảng tin</h2>

<ul class="nav nav-tabs" id="feedTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all"
                type="button" role="tab">
            Tất cả
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="following-tab" data-bs-toggle="tab" data-bs-target="#following"
                type="button" role="tab">
            Đang theo dõi
        </button>
    </li>
</ul>

<div class="tab-content mt-3">
    <!-- Tab tất cả -->
    <div class="tab-pane fade show active" id="all" role="tabpanel">

        @if (User.Identity.IsAuthenticated)
        {
            <div class="row">
                <div class="col-8">
                    <div class="card mb-3">
                        <div class="card-body">
                            @using (Html.BeginForm("CreateArticle", "Home", FormMethod.Post, new { id = "articleForm" }))
                            {
                                @Html.AntiForgeryToken()
                                <input id="articleTitle"
                                       name="title"
                                       class="form-control mb-2"
                                       maxlength="200"
                                       placeholder="Tiêu đề" />

                                <div class="position-relative">
                                    <input id="articleTag"
                                           name="tag"
                                           class="form-control mb-2"
                                           placeholder="Nhập 1 tag (gõ để gợi ý)" autocomplete="off" />
                                    <div id="tagSuggestions"
                                         class="list-group position-absolute w-100"
                                         style="z-index:1000; display:none;"></div>
                                </div>


                                <textarea id="articleContent"
                                          name="content"
                                          class="form-control"
                                          rows="3"
                                          maxlength="2000"
                                          placeholder="Bạn đang nghĩ gì?"
                                          style="resize: none;"></textarea>

                                <div class="mt-2 d-flex justify-content-between">
                                    <small class="text-muted">
                                        <span id="charCount">0</span>/2000
                                    </small>
                                    <button type="submit" class="btn btn-primary">Đăng</button>
                                </div>
                                <div id="postError" class="text-danger mt-2"></div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="alert alert-info">
                Hãy <a href="@Url.Action("Login","Session")">đăng nhập</a> để đăng bài.
            </div>
        }


        @Html.Partial("_ArticleList", Model.AllArticles)

    </div>
    <div class="tab-pane fade" id="following" role="tabpanel">
        @if (User.Identity.IsAuthenticated && Model.FollowingArticles != null)
        {

            @Html.Partial("_ArticleList", Model.FollowingArticles)
        }
        else
        {
            <div class="alert alert-info">Hãy đăng nhập và theo dõi ai đó để xem bài viết.</div>
        }
    </div>

</div>

@section scripts{
    @Scripts.Render("~/bundles/home")
}
